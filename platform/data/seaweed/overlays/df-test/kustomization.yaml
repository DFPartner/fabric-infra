apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 1. Inherit from Base
resources:
  - ../../base
  - external-secret.yaml # ADD the External Secret definition

# 2. Patch the Helm Chart with Prod Values
patches:
  - patch: |-
      apiVersion: helm.cattle.io/v1
      kind: HelmChart
      metadata:
        name: data-seaweedfs
        namespace: data
      spec:
        valuesContent: |-
          # We inject the content of values-prod.yaml here via Kustomize magic
          # (Or simpler: use helmCharts override below)
    target:
      kind: HelmChart
      name: data-seaweedfs

# BETTER WAY for Helm in Kustomize:
# Redefine the chart to merge the values
helmCharts:
  - name: seaweedfs
    repo: https://seaweedfs.github.io/seaweedfs/helm
    version: 4.0.406
    releaseName: data-seaweedfs
    namespace: data
    valuesFile: ../../base/values.yaml
    additionalValuesFiles:
      - values-df-test.yaml # <--- This merges prod values on top of base